from storage import *
from telegram import Update
from telegram.ext import ContextTypes
import random

# ===================== Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© =====================
async def reply(update, text):
    if update.message:
        await update.message.reply_text(text)

async def register_user(update):
    user_id = update.effective_user.id
    add_user(user_id)
    add_points(user_id,1)
    add_message(user_id)

# ===================== Ø±Ø¯ÙˆØ¯ Ù…Ø­Ø¯Ø¯Ø© Ø¨Ø§Ù„Ù„Ù‡Ø¬Ø© Ø§Ù„Ù…ØµØ±ÙŠØ© =====================
Ø±Ø¯ÙˆØ¯_Ù…ØµØ±ÙŠØ© = {
    "Ù‡Ø§ÙŠ": ["Ù‡Ø§ÙŠ ÙŠØ§ Ø­Ø¨ÙŠØ¨ÙŠ ğŸ˜", "Ø£Ù‡Ù„Ø§ Ø£Ù‡Ù„Ø§ ğŸ‘‹", "Ø¥Ø²ÙŠÙƒ ÙŠØ§ Ù…Ø¹Ù„Ù…!"],
    "Ø³Ù„Ø§Ù…": ["Ø³Ù„Ø§Ù… ÙŠØ§ Ù…Ø¹Ù„Ù… âœŒï¸", "ÙˆØ¹Ù„ÙŠÙƒÙ… Ø§Ù„Ø³Ù„Ø§Ù… ğŸ˜", "Ø£Ù‡Ù„Ø§ Ø¨ÙŠÙƒ!"],
    "Ø¹Ø§Ù…Ù„ Ø§ÙŠÙ‡": ["ØªÙ…Ø§Ù… Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡ ğŸ˜", "Ø²ÙŠ Ø§Ù„ÙÙ„ ÙˆØ§Ù†ØªØŸ", "ØªÙ…Ø§Ù… ÙˆØ§Ù†ØªØŸ"],
    "ØµØ¨Ø§Ø­ Ø§Ù„Ø®ÙŠØ±": ["ØµØ¨Ø§Ø­ Ø§Ù„Ù†ÙˆØ± ğŸŒ", "ØµØ¨Ø§Ø­ Ø§Ù„ÙˆØ±Ø¯ ğŸŒ¹", "ØµØ¨Ø§Ø­ Ø§Ù„ÙÙ„ ÙŠØ§ Ø¬Ù…ÙŠÙ„"],
    "Ù…Ø³Ø§Ø¡ Ø§Ù„Ø®ÙŠØ±": ["Ù…Ø³Ø§Ø¡ Ø§Ù„Ù†ÙˆØ± ğŸŒ™", "Ù…Ø³Ø§Ø¡ Ø§Ù„ÙÙ„ ÙŠØ§ Ø­Ù„Ùˆ", "Ù…Ø³Ø§Ø¡ Ø§Ù„ÙˆØ±Ø¯"],
    "Ø¨Ø­Ø¨Ùƒ": ["ÙˆØ£Ù†Ø§ ÙƒÙ…Ø§Ù† Ø¨Ø­Ø¨Ùƒ â¤ï¸", "ÙŠØ§Ø§Ø§Ù‡ Ø§Ù„Ø­Ø¨ Ø¯Ù‡ ğŸ˜", "Ø¨Ø­Ø¨Ùƒ Ø¨Ø±Ø¶Ù‡!"],
    "Ø´ÙƒØ±Ø§": ["Ø§Ù„Ø¹ÙÙˆ ğŸ˜", "ÙˆÙ„Ø§ ÙŠÙ‡Ù…Ùƒ ğŸ‘", "Ø­Ø§Ø¶Ø± ÙŠØ§ Ù…Ø¹Ù„Ù…"],
    "Ø¨Ø§ÙŠ": ["Ø¨Ø§ÙŠ Ø¨Ø§ÙŠ ğŸ‘‹", "Ø³Ù„Ø§Ù… âœŒï¸", "Ù†Ø´ÙˆÙÙƒ Ø¹Ù„Ù‰ Ø®ÙŠØ± ğŸ˜"]
}

# ===================== Ø§Ù„Ø±Ø¯ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© =====================
async def Ø±Ø¯_Ù…ØµØ±ÙŠ(update: Update, context: ContextTypes.DEFAULT_TYPE):
    await register_user(update)
    if not update.message or not update.message.text:
        return
    Ø§Ù„Ù†Øµ = update.message.text.lower().strip()
    
    if Ø§Ù„Ù†Øµ in Ø±Ø¯ÙˆØ¯_Ù…ØµØ±ÙŠØ©:
        Ø§Ù„Ø±Ø¯ = random.choice(Ø±Ø¯ÙˆØ¯_Ù…ØµØ±ÙŠØ©[Ø§Ù„Ù†Øµ])
        await reply(update, Ø§Ù„Ø±Ø¯)
        return

# ===================== Ø£ÙˆØ§Ù…Ø± Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø±Ø¯ÙˆØ¯ =====================
# Ø¥Ø¶Ø§ÙØ© Ø±Ø¯ Ø¬Ø¯ÙŠØ¯ Ù„Ù„ÙƒÙ„Ù…Ø©
async def Ø§Ø¶Ù_Ø±Ø¯_Ù…ØµØ±ÙŠ(update: Update, context: ContextTypes.DEFAULT_TYPE):
    if len(context.args) < 2:
        await reply(update, "Ø§ÙƒØªØ¨: /Ø§Ø¶Ù_Ø±Ø¯_Ù…ØµØ±ÙŠ Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø±Ø¯")
        return
    ÙƒÙ„Ù…Ø© = context.args[0].lower()
    Ø§Ù„Ø±Ø¯ = " ".join(context.args[1:])
    if ÙƒÙ„Ù…Ø© in Ø±Ø¯ÙˆØ¯_Ù…ØµØ±ÙŠØ©:
        Ø±Ø¯ÙˆØ¯_Ù…ØµØ±ÙŠØ©[ÙƒÙ„Ù…Ø©].append(Ø§Ù„Ø±Ø¯)
    else:
        Ø±Ø¯ÙˆØ¯_Ù…ØµØ±ÙŠØ©[ÙƒÙ„Ù…Ø©] = [Ø§Ù„Ø±Ø¯]
    await reply(update, f"âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±Ø¯ Ù„Ù„ÙƒÙ„Ù…Ø© '{ÙƒÙ„Ù…Ø©}'")

# Ø­Ø°Ù ÙƒÙ„Ù…Ø© ÙƒØ§Ù…Ù„Ø© Ù…Ù† Ø§Ù„Ø±Ø¯ÙˆØ¯
async def Ø­Ø°Ù_Ø±Ø¯_Ù…ØµØ±ÙŠ(update: Update, context: ContextTypes.DEFAULT_TYPE):
    if not context.args:
        await reply(update, "Ø§ÙƒØªØ¨: /Ø­Ø°Ù_Ø±Ø¯_Ù…ØµØ±ÙŠ Ø§Ù„ÙƒÙ„Ù…Ø©")
        return
    ÙƒÙ„Ù…Ø© = context.args[0].lower()
    if ÙƒÙ„Ù…Ø© in Ø±Ø¯ÙˆØ¯_Ù…ØµØ±ÙŠØ©:
        del Ø±Ø¯ÙˆØ¯_Ù…ØµØ±ÙŠØ©[ÙƒÙ„Ù…Ø©]
        await reply(update, f"ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø§Ù„ÙƒÙ„Ù…Ø© '{ÙƒÙ„Ù…Ø©}' Ù…Ù† Ø§Ù„Ø±Ø¯ÙˆØ¯")
    else:
        await reply(update, "âŒ Ø§Ù„ÙƒÙ„Ù…Ø© Ù…Ø´ Ù…ÙˆØ¬ÙˆØ¯Ø©")

# Ø¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„Ø±Ø¯ÙˆØ¯ ÙˆØ§Ù„ÙƒÙ„Ù…Ø§Øª
async def Ø¹Ø±Ø¶_Ø§Ù„Ø±Ø¯ÙˆØ¯(update: Update, context: ContextTypes.DEFAULT_TYPE):
    if not Ø±Ø¯ÙˆØ¯_Ù…ØµØ±ÙŠØ©:
        await reply(update, "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ø¯ÙˆØ¯ Ù…Ø¶Ø§ÙØ©")
        return
    Ù†Øµ = ""
    for ÙƒÙ„Ù…Ø©, Ù‚Ø§Ø¦Ù…Ø© in Ø±Ø¯ÙˆØ¯_Ù…ØµØ±ÙŠØ©.items():
        Ù†Øµ += f"{ÙƒÙ„Ù…Ø©} âœ {', '.join(Ù‚Ø§Ø¦Ù…Ø©)}\n"
    await reply(update, Ù†Øµ)

# ===================== Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø£ÙˆØ§Ù…Ø± =====================
commands = {
    "Ø±Ø¯_Ù…ØµØ±ÙŠ": Ø±Ø¯_Ù…ØµØ±ÙŠ,
    "Ø§Ø¶Ù_Ø±Ø¯_Ù…ØµØ±ÙŠ": Ø§Ø¶Ù_Ø±Ø¯_Ù…ØµØ±ÙŠ,
    "Ø­Ø°Ù_Ø±Ø¯_Ù…ØµØ±ÙŠ": Ø­Ø°Ù_Ø±Ø¯_Ù…ØµØ±ÙŠ,
    "Ø¹Ø±Ø¶_Ø§Ù„Ø±Ø¯ÙˆØ¯": Ø¹Ø±Ø¶_Ø§Ù„Ø±Ø¯ÙˆØ¯
  }
